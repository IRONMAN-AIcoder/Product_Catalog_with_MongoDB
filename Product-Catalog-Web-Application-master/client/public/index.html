<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog</title>

    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #007bff; /* A classic, reliable blue */
            --primary-hover: #0056b3;
            --secondary-color: #4A5568; /* A cool, dark gray */
            --accent-color: #805AD5; /* A vibrant purple for highlights */
            --accent-hover: #6B46C1;
            --success-color: #28a745;
            --error-color: #dc3545;
            --orange-color: #ED8936; /* New Orange */
            --orange-hover: #DD6B20; /* Darker Orange */
            --background-color: #F7FAFC; /* A very light gray */
            --card-background: #ffffff;
            --text-color: #1A202C; /* A very dark, near-black */
            --light-text-color: #718096; /* A lighter gray for subtext */
            --border-color: #E2E8F0;
            --star-color: #ffc107;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        .loading-fullscreen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 1.5rem;
            color: var(--light-text-color);
        }

        /* --- HEADER & FILTERS --- */
        .catalog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .welcome-message {
            font-size: 1.2rem; /* Increased size */
            font-weight: 500;
        }
        .welcome-message span {
            font-weight: 700;
            color: var(--text-color);
            text-transform: capitalize;
        }
        .header-actions { display: flex; gap: 1rem; }
        .btn-header {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-add-product { background-color: var(--orange-color); color: white; }
        .btn-add-product:hover { background-color: var(--orange-hover); }
        .btn-logout { background-color: var(--error-color); color: white; }
        .btn-logout:hover { background-color: #c82333; }

        .search-container {
            position: relative; /* Added */
            max-width: 700px;
            margin: 0 auto 2rem auto;
        }
        .search-container input {
            width: 100%;
            padding: 1rem 1.5rem 1rem 3.5rem; /* Modified for icon */
            font-size: 1.1rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            box-sizing: border-box;
        }
        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            color: var(--light-text-color);
            pointer-events: none;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            background: var(--card-background);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 3rem;
        }
        .filter-item { flex: 1; min-width: 150px; }
        .filter-item input, .filter-item select, .filter-item button {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            box-sizing: border-box;
            background-color: white;
        }
        .btn-reset {
            background-color: transparent;
            color: var(--secondary-color);
            font-weight: 600;
            cursor: pointer;
        }
        .btn-reset:hover {
            background-color: #EDF2F7;
            border-color: var(--secondary-color);
        }


        /* --- PRODUCT GRID & CARD STYLES --- */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; }
        .product-card {
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .product-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); }
        .product-image-wrapper { height: 220px; background-color: #e9ecef; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .product-image-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .product-info { padding: 1rem 1.25rem 1.25rem; display: flex; flex-direction: column; flex-grow: 1; }
        .product-info h3 { margin: 0 0 0.5rem 0; font-size: 1.1rem; font-weight: 600; line-height: 1.4; height: 3.2em; /* Approx 2 lines */ overflow: hidden; }
        .product-rating { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .product-rating .stars { color: var(--star-color); }
        .product-rating .rating-text { color: var(--light-text-color); }
        .product-price-container { margin: auto 0 0.5rem 0; padding-top: 1rem; }
        .product-price { font-size: 1.4rem; font-weight: 700; color: var(--text-color); }
        .product-price .mrp { font-size: 0.9rem; color: var(--light-text-color); text-decoration: line-through; margin-left: 0.5rem; }
        .product-bought-info { font-size: 0.9rem; font-weight: 500; color: var(--secondary-color); }
        .admin-controls { display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
        .btn-admin { flex-grow: 1; padding: 0.5rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.2s; }
        .btn-edit { background-color: #ffc107; color: #212529; }
        .btn-edit:hover { background-color: #e0a800; }
        .btn-delete { background-color: var(--error-color); color: white; }
        .btn-delete:hover { background-color: #c82333; }
        .btn-load-more { background-color: #212529; color: white; }
        .btn-load-more:hover { background-color: #212529; }

        /* --- SKELETON LOADER --- */
        .skeleton-card { background-color: #fff; border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; }
        .skeleton-image { height: 220px; background-color: #e0e0e0; }
        .skeleton-info { padding: 1.25rem; }
        .skeleton-line { height: 1.2em; margin-bottom: 0.8em; border-radius: 4px; background-color: #e0e0e0; }
        .skeleton-line.short { width: 60%; }
        .skeleton-line.price { width: 40%; height: 1.8em; }
        .skeleton-image, .skeleton-line { animation: skeleton-loading 1.5s infinite linear; }
        @keyframes skeleton-loading { 0% { background-color: #e0e0e0; } 50% { background-color: #f0f0f0; } 100% { background-color: #e0e0e0; } }

        /* --- MODAL, TOAST, PAGINATION & DETAIL VIEW STYLES --- */
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:1000}
        .modal-content{background:#fff;padding:2rem;border-radius:8px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto}
        .modal-content h2{margin-top:0}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
        .form-group{display:flex;flex-direction:column}
        .form-group.full-width{grid-column:1 / -1}
        .form-group label{margin-bottom:0.5rem;font-weight:500}
        .form-group input,.form-group textarea{padding:0.75rem;border:1px solid var(--border-color);border-radius:6px;font-size:1rem}
        .form-group textarea{min-height:100px;resize:vertical}
        .modal-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}
        .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:1rem 2rem;border-radius:8px;color:#fff;z-index:2000;animation:toast-in .5s,toast-out .5s 2.5s}
        .toast.success{background-color:var(--success-color)}
        .toast.error{background-color:var(--error-color)}
        @keyframes toast-in{from{bottom:-100px;opacity:0}to{bottom:20px;opacity:1}}
        @keyframes toast-out{from{bottom:20px;opacity:1}to{bottom:-100px;opacity:0}}
        .pagination{display:flex;justify-content:center;align-items:center;gap:1rem;margin-top:3rem}
        .product-detail-view{background-color:var(--card-background);border-radius:12px;box-shadow:var(--shadow);padding:2rem;display:grid;grid-template-columns:1fr 1fr;gap:2rem;animation:fadeIn .5s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .detail-image-container{text-align:center}
        .detail-image-container img{border-radius:8px;max-height:450px}
        .detail-info h1{font-size:2rem;margin:0 0 1rem 0}
        .detail-info .brand-category{font-size:1.1rem;color:var(--light-text-color);margin-bottom:1rem}
        .detail-price{font-size:2rem;font-weight:700;margin-bottom:1rem}
        .detail-section{margin-top:1.5rem}
        .detail-section h4{border-bottom:2px solid var(--accent-color);padding-bottom:.5rem;margin-bottom:1rem}
        .back-button{margin-bottom:2rem;padding:.75rem 1.5rem;border:1px solid var(--border-color);border-radius:8px;background-color:var(--card-background);color:var(--text-color);font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}
        .back-button:hover{background-color:#EDF2F7; border-color: var(--secondary-color);}
        @media (max-width: 768px){.product-detail-view,.form-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const API_BASE_URL = 'https://product-catalog-gnut.onrender.com';

        // --- REUSABLE & UI COMPONENTS ---
        const StarRating = ({ rating }) => {
            const fullStars = Math.floor(rating); const halfStar = rating % 1 >= 0.5; const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            return (<span className="stars">{'★'.repeat(fullStars)}{halfStar && '★'}{'☆'.repeat(emptyStars)}</span>);
        };
        const SkeletonCard = () => (<div className="skeleton-card"><div className="skeleton-image"></div><div className="skeleton-info"><div className="skeleton-line"></div><div className="skeleton-line short"></div><div className="skeleton-line" style={{ marginTop: '1rem' }}></div><div className="skeleton-line price"></div></div></div>);
        const Toast = ({ message, type }) => {
            if (!message) return null;
            return <div className={`toast ${type}`}>{message}</div>;
        };
        const ProductModal = ({ product, onClose, onSave }) => {
            const [formData, setFormData] = useState({ name: '', brand: '', category: '', price: '', mrp: '', rating: '', ratingsCount: '', boughtInPastMonth: '', description: '', warranty: '', returnPolicy: '' });
            const [imageFile, setImageFile] = useState(null);
            useEffect(() => { if (product) { const d = {}; for(const k in formData) { d[k] = product[k] || ''; } setFormData(d); } }, [product]);
            const handleChange = (e) => setFormData(p => ({ ...p, [e.target.name]: e.target.value }));
            const handleFileChange = (e) => setImageFile(e.target.files[0]);
            const handleSubmit = async (e) => { e.preventDefault(); const d = new FormData(); for (const k in formData) { d.append(k, formData[k]); } if (imageFile) { d.append('image', imageFile); } await onSave(d, product?._id); };
            return (<div className="modal-overlay" onClick={onClose}><div className="modal-content" onClick={e => e.stopPropagation()}><h2>{product ? 'Edit Product' : 'Add New Product'}</h2><form onSubmit={handleSubmit}><div className="form-grid"><div className="form-group"><label>Name</label><input name="name" value={formData.name} onChange={handleChange} required /></div><div className="form-group"><label>Brand</label><input name="brand" value={formData.brand} onChange={handleChange} required /></div><div className="form-group"><label>Category</label><input name="category" value={formData.category} onChange={handleChange} required /></div><div className="form-group"><label>Price (₹)</label><input type="number" name="price" value={formData.price} onChange={handleChange} required /></div><div className="form-group"><label>MRP (₹)</label><input type="number" name="mrp" value={formData.mrp} onChange={handleChange} required /></div><div className="form-group"><label>Rating (0-5)</label><input type="number" step="0.1" name="rating" value={formData.rating} onChange={handleChange} required /></div><div className="form-group"><label>Ratings Count</label><input name="ratingsCount" value={formData.ratingsCount} onChange={handleChange} required /></div><div className="form-group"><label>Bought in Past Month</label><input name="boughtInPastMonth" value={formData.boughtInPastMonth} onChange={handleChange} required /></div><div className="form-group"><label>Warranty</label><input name="warranty" value={formData.warranty} onChange={handleChange} required /></div><div className="form-group"><label>Return Policy</label><input name="returnPolicy" value={formData.returnPolicy} onChange={handleChange} required /></div><div className="form-group full-width"><label>Description</label><textarea name="description" value={formData.description} onChange={handleChange} required></textarea></div><div className="form-group full-width"><label>Product Image</label><input type="file" onChange={handleFileChange} /></div></div><div className="modal-actions"><button type="button" className="btn-admin btn-logout" onClick={onClose}>Cancel</button><button type="submit" className="btn-admin btn-add-product">Save Product</button></div></form></div></div>);
        };
        const ProductCard = ({ product, onCardClick, userRole, onEdit, onDelete }) => (<div className="product-card" onClick={() => onCardClick(product._id)}><div className="product-image-wrapper"><img src={`${API_BASE_URL}/${product.imageUrl}`} alt={product.name} onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/400x400/e9ecef/adb5bd?text=No+Image"; }} /></div><div className="product-info"><h3>{product.name}</h3><div className="product-rating"><StarRating rating={product.rating} /><span className="rating-text">{product.rating} ({product.ratingsCount})</span></div><div className="product-price-container"><span className="product-price">₹{product.price.toLocaleString()} <span className="mrp">M.R.P: ₹{product.mrp.toLocaleString()}</span></span></div><p className="product-bought-info">{product.boughtInPastMonth}+ bought in past month</p>{userRole === 'admin' && (<div className="admin-controls"><button className="btn-admin btn-edit" onClick={(e) => { e.stopPropagation(); onEdit(product); }}>Edit</button><button className="btn-admin btn-delete" onClick={(e) => { e.stopPropagation(); onDelete(product._id); }}>Delete</button></div>)}</div></div>);

        // --- PRODUCT DETAIL VIEW COMPONENT (MERGED) ---
        const ProductDetailView = ({ productId, onBack }) => {
            const [product, setProduct] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const fetchProduct = async () => {
                    try {
                        setIsLoading(true);
                        const response = await fetch(`${API_BASE_URL}/api/products/${productId}`);
                        const data = await response.json();
                        setProduct(data);
                    } catch (err) { console.error("Error fetching product details:", err); } 
                    finally { setIsLoading(false); }
                };
                fetchProduct();
            }, [productId]);

            if (isLoading) { return <div className="container"><p>Loading details...</p></div>; }
            if (!product) { return <div className="container"><p>Product not found.</p></div>; }

            return (
                <div className="container">
                    <button className="back-button" onClick={onBack}>← Back to Products</button>
                    <div className="product-detail-view">
                        <div className="detail-image-container">
                            <img src={`${API_BASE_URL}/${product.imageUrl}`} alt={product.name} onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/600x600/e9ecef/adb5bd?text=No+Image"; }} />
                        </div>
                        <div className="detail-info">
                            <p className="brand-category">{product.brand} - {product.category}</p>
                            <h1>{product.name}</h1>
                            <div className="product-rating" style={{ fontSize: '1.1rem' }}>
                                <StarRating rating={product.rating} />
                                <span className="rating-text" style={{ color: '#718096', marginLeft: '0.5rem' }}>
                                    {product.rating} ({product.ratingsCount} ratings)
                                </span>
                            </div>
                            <p className="detail-price">
                                ₹{product.price.toLocaleString()}
                                <span className="mrp" style={{ fontSize: '1.2rem', textDecoration: 'line-through', color: '#718096', marginLeft: '1rem' }}>
                                    M.R.P: ₹{product.mrp.toLocaleString()}
                                </span>
                            </p>
                            <div className="detail-section"><h4>About this item</h4><p>{product.description}</p></div>
                            <div className="detail-section"><h4>Warranty & Returns</h4><p><strong>Warranty:</strong> {product.warranty}</p><p><strong>Returns:</strong> {product.returnPolicy}</p></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN CATALOG VIEW COMPONENT ---
        const ProductCatalogView = ({ userRole, onCardClick }) => {
            const [products, setProducts] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [toast, setToast] = useState({ message: '', type: '' });
            const [currentPage, setCurrentPage] = useState(1);
            const [totalPages, setTotalPages] = useState(1);
            const [filters, setFilters] = useState({ search: '', category: 'All', sort: 'newest', minPrice: '', maxPrice: '' });
            const uniqueCategories = useRef(["All", "Electronics", "Fashion", "Home Goods", "Books", "Sports & Outdoors"]);

            const showToast = (message, type) => {
                setToast({ message, type });
                setTimeout(() => setToast({ message: '', type: '' }), 3000);
            };

            const fetchProducts = useCallback(async (pageToFetch) => {
                if (pageToFetch === 1) { setIsLoading(true); }
                const { search, category, sort, minPrice, maxPrice } = filters;
                const params = new URLSearchParams({ page: pageToFetch, limit: 8, search, category, sort });
                if (minPrice) params.append('minPrice', minPrice);
                if (maxPrice) params.append('maxPrice', maxPrice);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/products?${params.toString()}`);
                    const data = await response.json();
                    if (pageToFetch === 1) { setProducts(data.products); } else { setProducts(prev => [...prev, ...data.products]); }
                    setTotalPages(data.totalPages);
                    setCurrentPage(data.currentPage);
                } catch (err) { console.error("Error fetching products:", err); showToast('Failed to fetch products.', 'error'); } 
                finally { setIsLoading(false); }
            }, [filters]);

            useEffect(() => {
                fetchProducts(currentPage);
            }, [currentPage, fetchProducts]);
            
            const handleFilterChange = (e) => {
                const { name, value } = e.target;
                setFilters(prev => ({ ...prev, [name]: value }));
                setCurrentPage(1); 
            };
            
            const handleLoadMore = () => { if (currentPage < totalPages) { setCurrentPage(prev => prev + 1); } };
            const handleLogout = () => { sessionStorage.removeItem('userRole'); window.location.href = './login.html'; };
            const handleOpenModal = (product = null) => { setEditingProduct(product); setIsModalOpen(true); };
            const handleCloseModal = () => { setEditingProduct(null); setIsModalOpen(false); };
            
            const handleSaveProduct = async (formData, productId) => {
                const method = productId ? 'PUT' : 'POST';
                const url = productId ? `${API_BASE_URL}/api/products/${productId}` : `${API_BASE_URL}/api/products`;
                try {
                    const res = await fetch(url, { method, body: formData }); if (!res.ok) throw new Error();
                    showToast(`Product ${productId ? 'updated' : 'added'}!`, 'success');
                    handleCloseModal(); 
                    if (currentPage !== 1) setCurrentPage(1); else fetchProducts(1);
                } catch (err) { showToast('Failed to save product.', 'error'); }
            };
            
            const handleDeleteProduct = async (productId) => {
                if(window.confirm('Are you sure?')) {
                    try {
                        const res = await fetch(`${API_BASE_URL}/api/products/${productId}`, { method: 'DELETE' }); if (!res.ok) throw new Error();
                        showToast('Product deleted!', 'success'); 
                        if (currentPage !== 1) setCurrentPage(1); else fetchProducts(1);
                    } catch (err) { showToast('Failed to delete product.', 'error'); }
                }
            };
            
            const handleReset = () => {
                setFilters({ search: '', category: 'All', sort: 'newest', minPrice: '', maxPrice: '' });
                setCurrentPage(1);
            };

            return (
                <div className="container">
                    <header className="catalog-header">
                        <div className="welcome-message">Welcome, <span>{userRole}</span>!</div>
                        <div className="header-actions">
                            {userRole === 'admin' && <button className="btn-header btn-add-product" onClick={() => handleOpenModal()}>Add Product</button>}
                            <button className="btn-header btn-logout" onClick={handleLogout}>Logout</button>
                        </div>
                    </header>
                    <div className="search-container">
                       <svg className="search-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                       <input type="text" name="search" placeholder="Search for products..." value={filters.search} onChange={handleFilterChange} />
                    </div>
                    <div className="filter-container">
                        <div className="filter-item"><select name="category" value={filters.category} onChange={handleFilterChange}>{uniqueCategories.current.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
                        <div className="filter-item"><input type="number" name="minPrice" placeholder="Min Price" value={filters.minPrice} onChange={handleFilterChange} /></div>
                        <div className="filter-item"><input type="number" name="maxPrice" placeholder="Max Price" value={filters.maxPrice} onChange={handleFilterChange} /></div>
                        <div className="filter-item"><select name="sort" value={filters.sort} onChange={handleFilterChange}><option value="newest">Newest</option><option value="price-asc">Price: Low to High</option><option value="price-desc">Price: High to Low</option><option value="rating">Top Rated</option></select></div>
                        <div className="filter-item"><button className="btn-reset" onClick={handleReset}>Reset Filters</button></div>
                    </div>
                    <main>
                        <div className="product-grid">
                            {isLoading && products.length === 0 ? ( Array.from({ length: 8 }).map((_, i) => <SkeletonCard key={i} />))
                               : (products.map(p => (<ProductCard key={p._id} product={p} onCardClick={onCardClick} userRole={userRole} onEdit={handleOpenModal} onDelete={handleDeleteProduct}/>)))}
                        </div>
                        {!isLoading && products.length === 0 && <p style={{textAlign: 'center', padding: '2rem'}}>No products match your criteria.</p>}
                        <div className="pagination">
                            {!isLoading && currentPage < totalPages && (
                                <button onClick={handleLoadMore} className="btn-header btn-load-more" style={{margin: '0 auto', display: 'block'}}>Load More Results</button>
                            )}
                        </div>
                    </main>
                    {isModalOpen && <ProductModal product={editingProduct} onClose={handleCloseModal} onSave={handleSaveProduct} />}
                    <Toast message={toast.message} type={toast.type} />
                </div>
            );
        };
        
        // --- TOP-LEVEL APP COMPONENT ---
        const App = () => {
            const [userRole, setUserRole] = useState(null);
            const [selectedProductId, setSelectedProductId] = useState(null);

            useEffect(() => {
                const role = sessionStorage.getItem('userRole');
                if (!role) { window.location.href = './login.html'; } 
                else { setUserRole(role); }
            }, []);

            if (!userRole) { return <div className="loading-fullscreen">Loading...</div>; }

            if (selectedProductId) {
                // Now we call the component directly, since it's in the same file
                return <ProductDetailView productId={selectedProductId} onBack={() => setSelectedProductId(null)} />;
            }
            
            return <ProductCatalogView userRole={userRole} onCardClick={setSelectedProductId} />;
        };

        const domNode = document.getElementById('root');
        const root = ReactDOM.createRoot(domNode);
        root.render(<App />);
    </script>
</body>
</html>

